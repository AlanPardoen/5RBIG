---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


On récupére l'ensemble des donnés 
```{r}
library(devtools)
library(flexdashboard)
library(lubridate)
library(dplyr)
library(ggplot2)
library(ggstance)
library(ggalt)
library(readxl)

fatalEncounters <- read.csv("FatalEncounters.csv", header=TRUE, sep=",")
WahsingtonPost <- read.csv("WahsingtonPostDatabase.csv", header=TRUE, sep=",")
WahsingtonPost$date <- ymd(WahsingtonPost$date)
policeDeaths <- read.csv("PoliceDeaths.csv", header=TRUE, sep=",")

TaxPolicyCenter <- read_excel("TaxPolicyCenter.xls" )
TaxPolicyCenter <- na.omit(TaxPolicyCenter)
names(TaxPolicyCenter) <- c('regionsandstates', 'total','intergovernmental','total2', 'Elementaryandsecondaryeducation', 'Highereducation', 'Publicwelfare', 
                       'healthandhospital', 'highways', 'police', 'all other', 'ExhibitpersonalIncome[1](millions)')
TaxPolicyCenter$police <- as.numeric(as.character(TaxPolicyCenter$police))
```




Le nombre de civils tués durant un intervention présentant des troubles menteaux
```{r}
illessinfo <- WahsingtonPost %>% group_by(signs_of_mental_illness) %>% summarise(n = n()) %>% 
  arrange(signs_of_mental_illness) %>% 
  mutate(signs_of_mental_illness = factor(signs_of_mental_illness, levels = rev(unique(signs_of_mental_illness))))

ggplot(illessinfo, aes(x="", y=n, fill=signs_of_mental_illness))+
  geom_bar(width = 1, stat = "identity")+
  ggtitle("WahsingtonPost illessinfo")+
  coord_polar("y", start=0)


illessinfo <- fatalEncounters %>% group_by(Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS) %>% summarise(n = n()) %>% 
  arrange(Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS) %>% 
  mutate(Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS = factor(Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS, levels = rev(unique(Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS))))

ggplot(illessinfo, aes(x="", y=n, fill=Foreknowledge.of.mental.illness..INTERNAL.USE..NOT.FOR.ANALYSIS))+
  geom_bar(width = 1, stat = "identity")+
  ggtitle("FatalEncounters illessinfo")+
  coord_polar("y", start=0)
```

comparont maintenant les deux bases concernant les civils a savoir fatalencouter et wahsingtonPost sur les niveaux de danger, les armes et les delits de fuites 

Commençont par le niveau d'armes:

```{r}
armedinfo <- WahsingtonPost %>% group_by(armed) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% top_n(15) %>% 
  mutate(armed = factor(armed, levels = rev(unique(armed))))

ggplot(data = armedinfo, aes(x = n, y = armed)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("WahsingtonPost armedinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")


armedinfo <- fatalEncounters %>% group_by(Armed.Unarmed) %>% summarise(n = n()) %>% 
  arrange(desc(n))  %>% 
  mutate(Armed.Unarmed = factor(Armed.Unarmed, levels = rev(unique(Armed.Unarmed))))

ggplot(data = armedinfo, aes(x = n, y = Armed.Unarmed)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("FatalEncounters armedinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

```
Continuont sur le comportement et niveau de menace:
```{r}
threatinfo <- WahsingtonPost %>% group_by(threat_level) %>% summarise(n = n()) %>% 
  arrange(desc(n))  %>% 
  mutate(armed = factor(threat_level, levels = rev(unique(threat_level))))

ggplot(data = threatinfo, aes(x = n, y = threat_level)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("WahsingtonPost threatinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")


threatinfo <- fatalEncounters %>% group_by(Aggressive.physical.movement) %>% summarise(n = n()) %>% 
  arrange(desc(n))  %>% 
  mutate(Aggressive.physical.movement = factor(Aggressive.physical.movement, levels = rev(unique(Aggressive.physical.movement))))

ggplot(data = threatinfo, aes(x = n, y = Aggressive.physical.movement)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("FatalEncounters threatinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")
```

On peut constater que donné de washingtonpost sont remplis beaucoup plus assidûment, de nombreuses colones de fatalEncouter sont réguliérement pas remplis ou non référencié. Peut-être que ces variations ne sont pas présentent sur tout les données on va donc étudié des donnés qui sont plus plus basée sur les personne et moins sur la confrontation.


Comparont déja l'origine ethnique de chacune des personnes décédés
```{r}
raceinfo <- WahsingtonPost %>% group_by(race) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% mutate(race = factor(race, levels = rev(unique(race))))

ggplot(data = raceinfo, aes(x = n,y = race)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("WahsingtonPost Raceinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

raceinfo <- fatalEncounters %>% group_by(Race.with.imputations) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>%  
  mutate(Race.with.imputations = factor(Race.with.imputations, levels = rev(unique(Race.with.imputations))))

ggplot(data = raceinfo, aes(x = n,y = Race.with.imputations)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("FatalEncounters Raceinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

ggboxplot(WahsingtonPost, x = "race", y = "age") +
  ggtitle("WahsingtonPost Raceinfo and age comparaison")
```

On serait vite tenter de déterminé une forme de descrimination ici cependant, il faut préciser que nous ne connaisons pas la répartitition des popultations sur le teritoire americain. Il est probable que les European-Americain/white represente une population majeur sur le téritoire americain toutefois, sans information suplementaire nous ne pouvons pas en déterminé plus.

comparont les age de chacun des database et essayon de trouver un tranche "cible"

```{r}
ageinfo <- WahsingtonPost %>% group_by(age) %>% summarise(n = n()) %>% 
  arrange(age) %>% top_n(25) %>% 
  mutate(age = factor(age, levels = rev(unique(age))))

ggplot(data = ageinfo, aes(x = n,y = age)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("WahsingtonPost Ageinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

ageinfo <- fatalEncounters %>% group_by(Age) %>% summarise(n = n()) %>% 
  arrange(Age) %>% top_n(25) %>% 
  mutate(Age = factor(Age, levels = rev(unique(Age))))
  
ggplot(data = ageinfo, aes(x = n,y = Age)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("fatalEncounters Ageinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

print("WahsingtonPost mean")
result.mean <-  mean(WahsingtonPost$age,na.rm = TRUE)
print(result.mean)

print("fatalEncounters mean")
fatalEncounters$Age <- as.numeric(as.character(fatalEncounters$Age))
result.mean <-  mean(fatalEncounters$Age,na.rm = TRUE)
print(result.mean)

print("WahsingtonPost median")
result.median <-  median(WahsingtonPost$age,na.rm = TRUE)
print(result.median)

print("fatalEncounters median")
result.median <-  median(fatalEncounters$Age,na.rm = TRUE)
print(result.median)


estimate_mode <- function(x) {
  d <- density(x,na.rm = TRUE)
  d$x[which.max(d$y)]
}

print("WahsingtonPost Mode")
result.mode <-  estimate_mode(WahsingtonPost$age)
print(result.mode)


print("fatalEncounters Mode")
result.mode <-  estimate_mode(fatalEncounters$Age)
print(result.mode)

```

```{r}
WahsingtonPost$date <- ymd(WahsingtonPost$date)
ggplot(data = WahsingtonPost, aes(x = date)) + 
    ggtitle("WahsingtonPost dateinfo")+
  geom_histogram(aes(fill = ..count..), bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(x = NULL, y = "Number of deaths")


```
```{r}
stateinfo <- WahsingtonPost %>% group_by(state) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% top_n(15) %>% 
  mutate(state = factor(state, levels = rev(unique(state))))

ggplot(stateinfo, aes(x = n, y = state)) +
  ggtitle("WahsingtonPost stateinfo")+
  geom_barh(stat="identity", aes(fill = n)) +
  geom_text(aes(x = 17, y = state, label=as.character(state)), color="white", size=4) +
  labs(y = NULL, x = "Number of deaths") +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  theme_minimal(base_size = 13) +
  theme(axis.text.y=element_blank()) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0))

stateinfo <- fatalEncounters %>% group_by(State) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% top_n(15) %>% 
  mutate(State = factor(State, levels = rev(unique(State))))

ggplot(stateinfo, aes(x = n, y = State)) +
  ggtitle("FatalEncounters stateinfo")+
  geom_barh(stat="identity", aes(fill = n)) +
  geom_text(aes(x = 20, y = State, label=as.character(State)), color="white", size=4) +
  labs(y = NULL, x = "Number of deaths") +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  theme_minimal(base_size = 15) +
  theme(axis.text.y=element_blank()) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0))


```


```{r}

fleeinfo <- WahsingtonPost %>% group_by(flee) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>%
  mutate(flee = factor(flee, levels = rev(unique(flee))))

ggplot(data = fleeinfo, aes(x = n, y = flee)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("WahsingtonPost fleeinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

fleeinfo <- fatalEncounters %>% group_by(Fleeing.Not.fleeing) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>%
  mutate(Fleeing.Not.fleeing = factor(Fleeing.Not.fleeing, levels = rev(unique(Fleeing.Not.fleeing))))

ggplot(data = fleeinfo, aes(x = n, y = Fleeing.Not.fleeing)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  ggtitle("fatalEncounters fleeinfo")+
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")


```

```{r}

ggplot(data = TaxPolicyCenter, aes(x = police ,y = regionsandstates)) + 
  geom_barh(stat="identity", aes(fill = police)) +
  ggtitle("TaxPolicyCenter regionsandstates Finance")+
  theme_minimal(base_size = 8) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "green") +
  labs(y = "regionsandstates", x = "Finance")

stateinfo <- WahsingtonPost %>% group_by(state) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% top_n(15) %>% 
  mutate(state = factor(state, levels = rev(unique(state))))

ggplot(stateinfo, aes(x = n, y = state)) +
  ggtitle("WahsingtonPost stateinfo")+
  geom_barh(stat="identity", aes(fill = n)) +
  geom_text(aes(x = 17, y = state, label=as.character(state)), color="white", size=4) +
  labs(y = NULL, x = "Number of deaths") +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  theme_minimal(base_size = 13) +
  theme(axis.text.y=element_blank()) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0))

stateinfo <- policeDeaths %>% group_by(state) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>% top_n(15) %>% 
  mutate(state = factor(state, levels = rev(unique(state))))

ggplot(data = stateinfo, aes(x = n,y = state)) + 
  ggtitle("policeDeaths stateinfo")+
  geom_barh(stat="identity", aes(fill = n)) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

print("TaxPolicyCenter mean")
result.mean <-  mean(TaxPolicyCenter$police,na.rm = TRUE)
print(result.mean)
# poids des souris
# test de student pour échantillon unique
res<-t.test(TaxPolicyCenter$police, mu=TaxPolicyCenter$police[TaxPolicyCenter$regionsandstates == "California"])
print("t test for California")
print(res)

print("TaxPolicyCenter median")
result.median <-  median(TaxPolicyCenter$police,na.rm = TRUE)
print(result.median)


estimate_mode <- function(x) {
  d <- density(x,na.rm = TRUE)
  d$x[which.max(d$y)]
}

print("TaxPolicyCenter Mode")
result.mode <-  estimate_mode(TaxPolicyCenter$police)
print(result.mode)



```
```{r}
yearinfo <- policeDeaths %>% group_by(year) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>%  top_n(15) %>% 
  mutate(year = factor(year, levels = rev(unique(year))))

ggplot(data = yearinfo, aes(x = n,y = year)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")

yearinfo <- policeDeaths %>% group_by(year) %>% summarise(n = n()) %>% 
  arrange(desc(year)) %>% 
  mutate(year = factor(year, levels = rev(unique(year))))

ggplot(data = yearinfo[0:20,], aes(x = n,y = year)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")
```
```{r}

causeinfo <- policeDeaths %>% group_by(cause_short) %>% summarise(n = n()) %>% 
  arrange(desc(n)) %>%  
  mutate(cause_short = factor(cause_short, levels = rev(unique(cause_short))))

ggplot(data = causeinfo, aes(x = n,y = cause_short)) + 
  geom_barh(stat="identity", aes(fill = n)) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_x_continuous(expand=c(0,0)) +
  scale_fill_gradient(low = "dodgerblue", high = "firebrick1") +
  labs(y = NULL, x = "Number of deaths")


```

```{r}

```

